WITH OrderedLogs AS (
  SELECT user_id,
         event_time,
         LAG(event_time) OVER (
           PARTITION BY user_id
           ORDER BY event_time
         ) AS prev_time
  FROM Logs
),
IdlePeriods AS (
  SELECT user_id,
         EXTRACT(EPOCH FROM (event_time - prev_time)) / 3600.0 AS idle_hours
  FROM OrderedLogs
  WHERE prev_time IS NOT NULL
)
SELECT user_id,
       MAX(idle_hours) AS longest_idle_hours
FROM IdlePeriods
GROUP BY user_id;
